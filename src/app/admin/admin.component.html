<div class="container-fluid p-0">
    <nav class="navbar navbar-expand-sm bg-primary navbar-dark">
        <div class="container-fluid">
            <a href="/" class="navbar-brand">
                <b>Garden Imagination</b>
            </a>
            <ul class="navbar-nav">
                <li class="nav-item"><button type="button" class="btn btn-outline-light" (click)="logout()">Logout</button></li>
            </ul>
        </div>
    </nav>

    <h1 class="text-center my-4">Owners</h1>
    <div class="container">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-primary">
                <thead>
                    <tr>
                        <th scope="col">Id</th>
                        <th scope="col">Username</th>
                        <th scope="col">Password</th>
                        <th scope="col">Firstname</th>
                        <th scope="col">Lastname</th>
                        <th scope="col">Gender</th>
                        <th scope="col">Address</th>
                        <th scope="col">Contact</th>
                        <th scope="col">Email</th>
                        <th scope="col">Profile Picture</th>
                        <th scope="col">Credit Card</th>
                        <th scope="col">Status</th>
                        <th scope="col">Deactivate</th>
                        <th scope="col">Activate</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    <tr *ngFor="let owner of owners">
                        <th scope="row">{{ owner.id }}</th>
                        <td data-bs-toggle="modal" data-bs-target="#editUsernameModal" (click)="openModal(owner)">{{ owner.username }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editPasswordModal" (click)="openModal(owner)">{{ owner.password }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editFirstnameModal" (click)="openModal(owner)">{{ owner.firstname }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editLastnameModal" (click)="openLastnameModal(owner)">{{ owner.lastname }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editGenderModal" (click)="openModal(owner)">{{ owner.gender }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editAddressModal" (click)="openModal(owner)">{{ owner.address }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editContactModal" (click)="openModal(owner)">{{ owner.contact }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editEmailModal" (click)="openModal(owner)">{{ owner.email }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editProfilePictureModal" (click)="openModal(owner)">{{ owner.profilePicture }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editCreditCardModal" (click)="openModal(owner)">{{ owner.creditCard }}</td>
                        <td>{{ owner.status }}</td>
                        <td>
                            <button type="button" class="btn btn-primary" (click)="deactivateUser(owner.id)" [disabled]="owner.status == 'deactivated'">Deactivate</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-primary" (click)="activateUser(owner.id)" [disabled]="owner.status == 'active'">Activate</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="mb-3" *ngIf="errorMessage && isOwner">
                <div class="alert alert-danger" role="alert">
                    {{ errorMessage }}
                </div>
            </div>
        </div>
    </div>

    <h1 class="text-center my-4">Decorators</h1>
    <div class="container">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-primary">
                <thead>
                    <tr>
                        <th scope="col">Id</th>
                        <th scope="col">Username</th>
                        <th scope="col">Password</th>
                        <th scope="col">Firstname</th>
                        <th scope="col">Lastname</th>
                        <th scope="col">Gender</th>
                        <th scope="col">Address</th>
                        <th scope="col">Contact</th>
                        <th scope="col">Email</th>
                        <th scope="col">Profile Picture</th>
                        <th scope="col">Credit Card</th>
                        <th scope="col">Status</th>
                        <th scope="col">Deactivate</th>
                        <th scope="col">Activate</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    <tr *ngFor="let decorator of decorators">
                        <th scope="row">{{ decorator.id }}</th>
                        <td data-bs-toggle="modal" data-bs-target="#editUsernameModal" (click)="openModal(decorator)">{{ decorator.username }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editPasswordModal" (click)="openModal(decorator)">{{ decorator.password }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editFirstnameModal" (click)="openModal(decorator)">{{ decorator.firstname }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editLastnameModal" (click)="openModal(decorator)">{{ decorator.lastname }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editGenderModal" (click)="openModal(decorator)">{{ decorator.gender }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editAddressModal" (click)="openModal(decorator)">{{ decorator.address }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editContactModal" (click)="openModal(decorator)">{{ decorator.contact }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editEmailModal" (click)="openModal(decorator)">{{ decorator.email }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editProfilePictureModal" (click)="openModal(decorator)">{{ decorator.profilePicture }}</td>
                        <td data-bs-toggle="modal" data-bs-target="#editCreditCardModal" (click)="openModal(decorator)">{{ decorator.creditCard }}</td>
                        <td>{{ decorator.status }}</td>
                        <td>
                            <button type="button" class="btn btn-primary" (click)="deactivateUser(decorator.id)" [disabled]="decorator.status == 'deactivated'">Deactivate</button>
                        </td>
                        <td>
                            <button type="button" class="btn btn-primary" (click)="activateUser(decorator.id)" [disabled]="decorator.status == 'active'">Activate</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="mb-3" *ngIf="errorMessage && !isOwner">
                <div class="alert alert-danger" role="alert">
                    {{ errorMessage }}
                </div>
            </div>
        </div>
    </div>

    <h1 class="text-center my-4">Firms</h1>
    <div class="container">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-primary">
                <thead>
                    <tr>
                        <th scope="col">Id</th>
                        <th scope="col">Name</th>
                        <th scope="col">Address</th>
                        <th scope="col">Services</th>
                        <th scope="col">Decorators</th>
                        <th scope="col">Contact</th>
                        <th scope="col">Working Hours</th>
                        <th scope="col">Holiday</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    <tr *ngFor="let firm of firms">
                        <td>{{ firm.id }}</td>
                        <td>{{ firm.name }}</td>
                        <td>{{ firm.address }}</td>
                        <td>
                            <ul class="list-unstyled">
                                <li *ngFor="let service of firm.services">
                                    {{ service.service }} - {{ service.price }}
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-unstyled">
                                <li *ngFor="let decorator of firm.decorators">
                                    {{ decorator.username }}
                                </li>
                            </ul>
                        </td>
                        <td>{{ firm.contact }}</td>
                        <td>{{ firm.workingHoursStart }} - {{ firm.workingHoursEnd }}</td>
                        <td>{{ firm.holidayStart }} - {{ firm.holidayEnd }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <h1 class="text-center my-4">Pending Registrations</h1>
    <div class="container">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-primary">
                <thead class="thead-dark">
                    <tr>
                        <th>Username</th>
                        <th>Password</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Gender</th>
                        <th>Address</th>
                        <th>Phone Number</th>
                        <th>E-mail</th>
                        <th>Profile Picture</th>
                        <th>Credit Card</th>
                        <th>Review</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let user of pendingRegistrations">
                        <td>{{ user.username }}</td>
                        <td>{{ user.password }}</td>
                        <td>{{ user.firstname }}</td>
                        <td>{{ user.lastname }}</td>
                        <td>{{ user.gender }}</td>
                        <td>{{ user.address }}</td>
                        <td>{{ user.contact }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                            <img [src]="pendingProfilePicturesURL[pendingRegistrations.indexOf(user)]" alt="Profile Picture" class="img-fluid" style="max-width: 100px; max-height: 100px;">
                        </td>
                        <td>{{ user.creditCard }}</td>
                        <td>
                            <div class="d-flex justify-content-center align-items-center flex-column">
                                <button class="btn btn-primary btn-sm" style="width: 100%" (click)="acceptRegistration(user)">Accept</button>
                                <p></p>
                                <button class="btn btn-primary btn-sm" style="width: 100%" (click)="rejectRegistration(user)">Reject</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <h1 class="text-center my-4">Add a Decorator</h1>
    <div class="container mt-4 d-flex justify-content-center">
        <div class="card mb-4" style="width: 30rem;">
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <label for="username" class="form-label">Username:</label>
                        <input type="text" class="form-control" id="username" name="username" [(ngModel)]="username">
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Password:</label>
                        <input type="password" class="form-control" id="password" name="password" [(ngModel)]="password">
                    </div>
                    
                    <div class="mb-3">
                        <label for="firstname" class="form-label">Firstname:</label>
                        <input type="text" class="form-control" id="firstname" name="firstname" [(ngModel)]="firstname">
                    </div>
                    
                    <div class="mb-3">
                        <label for="lastname" class="form-label">Lastname:</label>
                        <input type="text" class="form-control" id="lastname" name="lastname" [(ngModel)]="lastname">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Gender:</label>
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="gender" id="male" value="M" [(ngModel)]="gender">
                                <label class="form-check-label" for="male">Male</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="gender" id="female" value="F" [(ngModel)]="gender">
                                <label class="form-check-label" for="female">Female</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="address" class="form-label">Address:</label>
                        <input type="text" class="form-control" id="address" name="address" [(ngModel)]="address">
                    </div>
                    
                    <div class="mb-3">
                        <label for="contact" class="form-label">Contact:</label>
                        <input type="text" class="form-control" id="contact" name="contact" [(ngModel)]="contact">
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">E-mail address:</label>
                        <input type="text" class="form-control" id="email" name="email" [(ngModel)]="email">
                    </div>
            
                    <div class="mb-3">
                        <label class="form-label">Profile picture:</label>
                        <input type="file" class="form-control" id="profilePicture" name="profilePicture" (change)="onFileSelectedDecorator($event)">
                    </div>
                    
                    <div class="mb-3">
                        <label for="creditCard" class="form-label">Credit Card Number:</label>
                        <input type="text" class="form-control" id="creditCard" name="creditCard" (input)="checkCardType()" [(ngModel)]="creditCard">
                        <img *ngIf="cardType" [src]="cardType" alt="Card Type" width="60px">
                    </div>
                    
                    <div class="mb-3" *ngIf="errorMessageDecorator">
                        <div class="alert alert-danger" role="alert">
                            {{ errorMessageDecorator }}
                        </div>
                    </div>

                    <div class="mb-3" *ngIf="successMessage">
                        <div class="alert alert-success" role="alert">
                            {{ successMessage }}
                        </div>
                    </div>
   
                    <div class="mb-3 d-flex justify-content-center">
                        <button type="button" class="btn btn-primary" (click)="addDecorator()">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <h1 class="text-center my-4">Add a Firm</h1>
    <div class="container mt-4 d-flex justify-content-center">
        <div class="card mb-4" style="width: 30rem;">
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <label for="firmName" class="form-label">Name:</label>
                        <input type="text" class="form-control" id="firmName" name="firmName" [(ngModel)]="firmName">
                    </div>
                    
                    <div class="mb-3">
                        <label for="firmAddress" class="form-label">Address:</label>
                        <input type="text" class="form-control" id="firmAddress" name="firmAddress" [(ngModel)]="firmAddress">
                    </div>
                    
                    <div class="mb-3">
                        <h4>Services:</h4>
                        <label for="service" class="form-label">Service:</label>
                        <input type="text" class="form-control" id="service" name="service" [(ngModel)]="firmServiceToAdd.service">
                        <br>
                        <label for="servicePrice" class="form-label">Price:</label>
                        <input type="text" class="form-control" id="servicePrice" name="servicePrice" [(ngModel)]="firmServiceToAdd.price">
                        <br>
                        <div class="mb-3 d-flex justify-content-center">
                            <button type="button" class="btn btn-primary" (click)="addService()">Add Service</button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h4>Decorators:</h4>
                        <div class="list-group">
                            <a 
                              *ngFor="let decorator of decoratorsNoFirm"
                              class="list-group-item list-group-item-action"
                              (click)="addDecoratorToFirm(decorator)"
                              style="cursor: pointer;"
                            >
                                {{ decorator.username }}
                            </a>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="firmContact" class="form-label">Contact:</label>
                        <input type="text" class="form-control" id="firmContact" name="firmContact" [(ngModel)]="firmContact">
                    </div>

                    <h4>Working Hours:</h4>
                    <div class="mb-3">
                        <label for="firmWorkingHoursStart" class="form-label">Start:</label>
                        <input type="time" class="form-control" id="firmWorkingHoursStart" name="firmWorkingHoursStart" [(ngModel)]="firmWorkingHoursStart">
                    </div>

                    <div class="mb-3">
                        <label for="firmWorkingHoursEnd" class="form-label">End:</label>
                        <input type="time" class="form-control" id="firmWorkingHoursEnd" name="firmWorkingHoursEnd" [(ngModel)]="firmWorkingHoursEnd">
                    </div>

                    <h4>Holiday:</h4>
                    <div class="mb-3">
                        <label for="firmHolidayStart" class="form-label">Start:</label>
                        <input type="date" class="form-control" id="firmHolidayStart" name="firmHolidayStart" [(ngModel)]="firmHolidayStart">
                    </div>
                    
                    <div class="mb-3">
                        <label for="firmHolidayEnd" class="form-label">End:</label>
                        <input type="date" class="form-control" id="firmHolidayEnd" name="firmHolidayEnd" [(ngModel)]="firmHolidayEnd">
                    </div>
                    
                    <div class="mb-3" *ngIf="firmErrorMessage">
                        <div class="alert alert-danger" role="alert">
                            {{ firmErrorMessage }}
                        </div>
                    </div>
   
                    <div class="mb-3 d-flex justify-content-center">
                        <button type="button" class="btn btn-primary" (click)="addFirm()">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-primary text-white p-3 mt-auto text-center">
        <p class="mb-0">&copy; 2024 Garden Imagination</p>
    </footer>
</div>

<app-modal
    modalId="editUsernameModal"
    modalTitle="Edit username for {{ selectedUser.username }}"
    (saveChanges)="changeUsername(selectedUser.id)">
    <div class="mb-3">
        <label for="newUsername" class="col-form-label">New Username:</label>
        <input type="text" class="form-control" id="newUsername" [(ngModel)]="newUsername">
    </div>
</app-modal>

<app-modal
    modalId="editPasswordModal"
    modalTitle="Edit password for {{ selectedUser.username }}"
    (saveChanges)="changePassword(selectedUser.username)">
    <div class="mb-3">
        <label for="newPassword" class="col-form-label">New Password:</label>
        <input type="password" class="form-control" id="newPassword" [(ngModel)]="newPassword">
    </div>
</app-modal>

<app-modal
    modalId="editFirstnameModal"
    modalTitle="Edit firstname for {{ selectedUser.username }}"
    (saveChanges)="changeFirstname(selectedUser.id)">
    <div class="mb-3">
        <label for="newFirstname" class="col-form-label">New Firstname:</label>
        <input type="text" class="form-control" id="newFirstname" [(ngModel)]="newFirstname">
    </div>
</app-modal>

<app-modal
    modalId="editLastnameModal"
    modalTitle="Edit lastname for {{ selectedUser.username }}"
    (saveChanges)="changeLastname(selectedUser.id)">
    <div class="mb-3">
        <label for="newLastname" class="col-form-label">New Lastname:</label>
        <input type="text" class="form-control" id="newLastname" [(ngModel)]="newLastname">
    </div>
</app-modal>

<app-modal 
    modalId="editGenderModal"
    modalTitle="Edit gender for {{ selectedUser.username }}"
    (saveChanges)="changeGender(selectedUser.id)">
    <div class="mb-3">
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="gender" id="male" value="M" [(ngModel)]="newGender">
            <label class="form-check-label" for="male">Male</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="gender" id="female" value="F" [(ngModel)]="newGender">
            <label class="form-check-label" for="female">Female</label>
        </div>
    </div>
</app-modal>

<app-modal
    modalId="editAddressModal"
    modalTitle="Edit address for {{ selectedUser.username }}"
    (saveChanges)="changeAddress(selectedUser.id)">
    <div class="mb-3">
        <label for="newAddress" class="col-form-label">New Address:</label>
        <input type="text" class="form-control" id="newAddress" [(ngModel)]="newAddress">
    </div>
</app-modal>

<app-modal
    modalId="editContactModal"
    modalTitle="Edit contact for {{ selectedUser.username }}"
    (saveChanges)="changeContact(selectedUser.id)">
    <div class="mb-3">
        <label for="newContact" class="col-form-label">New Contact:</label>
        <input type="text" class="form-control" id="newContact" [(ngModel)]="newContact">
    </div>
</app-modal>

<app-modal
    modalId="editEmailModal"
    modalTitle="Edit email for {{ selectedUser.username }}"
    (saveChanges)="changeEmail(selectedUser.id)">
    <div class="mb-3">
        <label for="newEmail" class="col-form-label">New Email:</label>
        <input type="text" class="form-control" id="newEmail" [(ngModel)]="newEmail">
    </div>
</app-modal>

<app-modal
    modalId="editProfilePictureModal"
    modalTitle="Edit profile picture for {{ selectedUser.username }}"
    (saveChanges)="changeProfilePicture(selectedUser.id)">
    <div class="mb-3">
        <label for="newProfilePicture" class="col-form-label">New Profile Picture:</label>
        <input type="file" class="form-control" id="newProfilePicture" name="newProfilePicture" (change)="onFileSelected($event)">
    </div>
</app-modal>

<app-modal
    modalId="editCreditCardModal"
    modalTitle="Edit credit card for {{ selectedUser.username }}"
    (saveChanges)="changeCreditCard(selectedUser.id)">
    <div class="mb-3">
        <label for="newCreditCard" class="col-form-label">New Credit Card:</label>
        <input type="text" class="form-control" id="newCreditCard" [(ngModel)]="newCreditCard">
    </div>
</app-modal>